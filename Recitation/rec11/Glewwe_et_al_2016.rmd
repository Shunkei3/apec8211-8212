---
title: "Replicate: Glewwe et al. (2016)"
author: "Shunkei Kakimoto"
output:
  html_document:
    number_sections: yes
    theme: cerulean
    toc_float: yes
    toc: yes
    toc_depth: 3
geometry: margin=1in
---

```{r setup, include=FALSE}
# library(here)
# here::i_am("")

# opts_knit$set(root.dir = "")
# opts_knit$set(root.dir = here())

knitr::opts_chunk$set(
  echo = TRUE,
  cache = FALSE,
  comment = NA,
  message = FALSE,
  warning = FALSE,
  tidy = FALSE,
  cache.lazy = FALSE
)
```

<style type="text/css">
  body{
  font-size: 12pt;
}
</style>

```{r, eval=F, echo=F}
# httpgd::hgd()
# httpgd::hgd_browse()
```

# Objective
+ To replicate some of the tables from "A better vision for development: Eyeglasses and academic performance in rural primary schools in China" by Glewwe et al. (2016) [[here](https://www.sciencedirect.com/science/article/abs/pii/S0304387816300402?casa_token=IfEDnZXp-WcAAAAA:5xgI0-rX4NlO2jg3nBIOGAZdzan3qIqWS0XSyzLMwQE4AzqbeERSS7zr_SwKi631r5nCs9Lf)] and use wild cluster bootstrap.


# Data

First, run this code chunk. 

```{r}
# === Package === #
library(data.table)
library(dplyr)
library(sandwich)
library(rio)

# === Load the data === #
# load("data/glewwe_cleaned.Rdata")
# data <- data.table(basicinfo)

# data <- 
# 	import("data/glewwe_rplicate.dta") %>%
# 	data.table()

# --- Select the compliant sample --- #
data <- data[ittsamp8==1,]
```

## Variables
+ `countycode`: takes 1 for County 1, and 2 for County 2. 
+ `badvision`: takes 1 if the student had bad vision, and 0 for the student with good vision. 
+ `trttown`: Treatment indicator. `trttown` takes 1 if the student belongs to a school in the treated townships, 0 otherwise. 
+ `chinese04s2`, `math04s2`, `science04s2`: Exam scores on Chinese, math and science  before the program (2003-04 school year)
+ `chinese05s2`, `math05s2`, `science05s2`: Exam scores on Chinese, math and science  before the program (2004-05 school year)
+ `sdchi04s2`, `sdmat04s2`, `sdsci04s2` : Standardized test scores before the program.  
+  `sdchi05s2`, `sdmat05s2`, `sdsci05s2` : Standardized test scores before the program




+  "To ease interpretation, all estimates in this paper use test scores that are standardized by subtracting the control school's mean and dividing by the control schools' (student level) standard deviation, separately for each subject and grade." (p173)



# Table 1: Descriptive statistics for 25 "compliant" townships

```{r}
#/*--------------------------------*/
#' ## Table 1 (25 compliant townships)
#/*--------------------------------*/
# === 1. The number of children by county === #
row1 <- data[, .(count = .N), by=countycode]

print(row1[order(countycode),])

# === 2. The number of Children with vision problem === #
row2 <- data[,.(count=.N), by=.(countycode, badvision)]

print(row2[order(countycode),])

# --- report of the percentage  --- #
# row2 <- subdata[,.(count=.N), by=.(countycode, badvision)] %>%
# 	.[,county_pop := sum(count), by=countycode] %>%
# 	.[, frac := count/county_pop*100] %>%
# 	.[badvision==1,]
# row2

# === 3. The number of students with bad vision by whether the student has glasses or not. === #
row3 <- 
	data[badvision==1, .(count=.N), by=.(countycode, glsbefor)]

print(row3[order(countycode, -glsbefor),])

# === Mean pre-test scores by student's vision status === #
row4_5 <- 
	data[,.(
		avg_chinease = round(mean(chinese04s2, na.rm=TRUE),1),
		avg_math = round(mean(math04s2, na.rm=TRUE),1),
		avg_science = round(mean(science04s2, na.rm=TRUE),1)
		), by=.(countycode, badvision)]

print(row4_5[order(countycode, badvision),])
```


# Table 3 (for County 1)

Let's check whether the treatment and control townships in the compliant sample are similar or not.

For example, is there any significant pre-program difference in the standardized scores on Chinese exam between the treatment and control groups?

```{r}
library(fixest)

ch_tr <- feols(sdchi04s2~trttown|, data=data[countycode==1,])



```


# Table 4

