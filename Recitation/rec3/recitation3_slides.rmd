---
title: "APEC8211: Recitation 3"
author: 
  - "Shunkei Kakimoto" 
header-includes:
   - \usepackage{mathtools}
   - \usepackage{color}
   - \usepackage{amsmath}
output:
  xaringan::moon_reader:
    self_contained: true
    css: ../xaringan-themer.css 
    lib_dir: libs
    nature: 
      highlightStyle: github
      highlightLines: true
---
class: middle

```{r, child = '../setup.rmd', cache = FALSE}
```

```{r, include = F, cache = FALSE}
# here::i_am("GitControlled/Recitation/1_Introduction/recitation1_slides.rmd")
```


```{r, include = F, cache = FALSE}
library(data.table)
library(ggplot2)
library(dplyr)
library(gganimate)
library(gifski)
library(gganimate)
```

```{r, include = F, eval=F, cache = FALSE}
httpgd::hgd()
httpgd::hgd_browse()
```



.content-box-green[**A Useful tip:**]

hitting letter "o" key will give you a panel view of the slides

---

# Outline
+ independence, mean independence, and uncorrelation


---



---

## Assignment 2: Question 4-(c)

Here, we want to check $E[M]=E[E[M|Q]]=9$. 

.panelset[ 

.panel[.panel-name[Data table way (assignment2code.r)]
.medium-code[
```{r, echo=T, cache=T}
set.seed(1234)

library(data.table)
n <- 1e7  # R notation for 1 x 10^7

mix <- 
  data.table(
    X = rchisq(n, 4), 
    Y = rchisq(n, 8), 
    Z = rchisq(n, 16),
    Q = sample(1:3, n, prob=c(0.25, 0.5, 0.25), replace=TRUE)
  )

# fcase gives M the value of X if Q==1, Y if Q==2, Z if Q==3
mix[ , M := fcase(Q==1, X, 
                  Q==2, Y,
                  Q==3, Z)]

# See the means of all columns (.SD means all columns).
# lapply()  translates to "Apply the function 'mean' to every column."
mix[ , lapply(.SD, mean)]
```
    ]
  ]


.panel[.panel-name[basic R way]
.medium-code[
```{r, echo=T, cache=T}
set.seed(1234)

library(dplyr)

n <- 1e7  # R notation for 1 x 10^7

mix <- data.frame(
  X = rchisq(n, 4), 
  Y = rchisq(n, 8), 
  Z = rchisq(n, 16),
  Q = sample(1:3, n, prob=c(0.25, 0.5, 0.25), replace=TRUE)
  )

# sntax: ifelse(condition, x if condition is met, y otherwise)
mix$M <- 
  ifelse(mix$Q==1, mix$X,
    ifelse(mix$Q==2, mix$Y, mix$Z))

colMeans(mix)
```
    ]
  ]


.panel[.panel-name[dplyr way]
Don't use dplyr in the test!
.medium-code[
```{r, echo=T, cache=T}
set.seed(1234)

library(dplyr)

n <- 1e7  # R notation for 1 x 10^7

mix <- data.frame(
  X = rchisq(n, 4), 
  Y = rchisq(n, 8), 
  Z = rchisq(n, 16),
  Q = sample(1:3, n, prob=c(0.25, 0.5, 0.25), replace=TRUE))

# case_when is the dplyr version of fcase 
mix <- mutate(mix, M = case_when(Q==1 ~ X, Q==2 ~ Y, Q==3 ~ Z))

# 
summarise(mix,  across(X:M, mean))
# this is equivalent to 
# summarise(mix, X=mean(X), Y=mean(Y), Z=mean(Z), Q=mean(Q), M=mean(M))
```
    ]
  ]
]






