---
title: "Causal Forest Approach for Site-specific Input Management via On-farm Precision Experimentation"
author: 
  - "Shunkei Kakimoto, University of Nebraska Lincoln" 
  - "Advisor: Taro Mieno" 
header-includes:
   - \usepackage{mathtools}
   - \usepackage{color}
   - \usepackage{amsmath}
output:
  xaringan::moon_reader:
    css: xaringan-themer.css 
    lib_dir: libs
    nature: 
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
bibliography: ML_VRA.bib
csl: computers-and-electronics-in-agriculture.csl
---
class: middle

```{r, child = 'setup.rmd', cache = FALSE}
```

```{css}
.remark-slide-number {
  display: none;
}
```

```{r, include = F, cache = FALSE}
#--- load packages ---#
suppressMessages(library(data.table))
suppressMessages(library(tidyverse))
suppressMessages(library(DT))
suppressMessages(library(sf))
suppressMessages(library(here))
suppressMessages(library(flextable))
suppressMessages(library(printr))
suppressMessages(library(tidycensus))
suppressMessages(library(tmap))
suppressMessages(library(RefManageR))

here::i_am("GitControlled/Presentation/Defense/presen_slides.rmd")
```

```{r tmap-layout, cache = FALSE}
tm_layout_to_add <-
  tm_layout(
    legend.outside = "TRUE",
    frame = FALSE,
    legend.title.size = 2,
    legend.text.size = 1.5
  )
```

```{r setup, include=FALSE, cache = FALSE}
options(htmltools.dir.version = FALSE)

BibOptions(
  check.entries = FALSE,
  bib.style = "authoryear",
  style = "markdown",
  dashed = TRUE,
  max.names = 1,
  longnamesfirst = FALSE
)
file.name <- here("GitControlled/Writing/ML_VRA.bib")
bib <- ReadBib(file.name)
```

```{r figure_setup, cache = F}
theme_update(
  axis.title.x =
    element_text(
      size = 9, angle = 0, hjust = .5, vjust = -0.3, face = "plain"
    ),
  axis.title.y =
    element_text(
      size = 9, angle = 90, hjust = .5, vjust = .9, face = "plain"
    ),
  axis.text.x =
    element_text(
      size = 7, angle = 0, hjust = .5, vjust = 1.5, face = "plain"
    ),
  axis.text.y =
    element_text(
      size = 7, angle = 0, hjust = 1, vjust = 0, face = "plain"
    ),
  axis.ticks =
    element_line(
      size = 0.3, linetype = "solid"
    ),
  axis.ticks.length = unit(.15, "cm"),
  #--- legend ---#
  legend.text =
    element_text(
      size = 7, angle = 0, hjust = 0, vjust = 0, face = "plain"
    ),
  legend.title =
    element_text(
      size = 7, angle = 0, hjust = 0, vjust = 0, face = "plain"
    ),
  legend.key.size = unit(0.5, "cm"),
  #--- strip (for faceting) ---#
  strip.text = element_text(size = 7),
  #--- plot title ---#
  plot.title = element_text(family = "Times", face = "bold", size = 9),
  #--- margin ---#
  # plot.margin = margin(0, 0, 0, 0, "cm"),
  #--- panel ---#
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  panel.background = element_blank(),
  panel.border = element_rect(fill = NA)
)
```

```{r analyses, include = FALSE, cache = T}
# --- Convert an Rmd file into a pure R file using purl() ---#
knitr::purl(here("GitControlled/Codes/PrepareResults.Rmd"), output = here("GitControlled/Codes/PrepareResults.R"))

# --- Read the simulation results and prepare figures and tables ---#
source(here("GitControlled/Codes/PrepareResults.R"))
```

# Causal Forest Approach for Site-specific Input Management via On-farm Precision Experimentation

+ Shunkei Kakimoto, University of Nebraska Lincoln
+ Taro Mieno, University of Nebraska Lincoln 
+ Takashi Tanaka, Gifu University, Japan
+ David S. Bullock, University of Illinois


---

# Outline

1. Introduction
  * Background of Site-specific Input Management
  * Predicting Yield vs. Predicting Changes in Yield in Response to Changes in Input Management

2. Materials and Methods
  * Monte Carlo Simulations
  * Estimation Methods

3. Results
  * EONR Estimation Accuracy
  * The Relationship Between Yield and EONR Prediction Performances

4. Conclusion
  * Summary
  * Limitations and Future Studies

---

class: inverse, center, middle
name: intro

# Introduction

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>


---
class: middle

# Site-specific input application technology

.content-box-green[**Concept**]
+ Applying varied input amounts (e,g., fertilizer, seed) site-specifically within a field depending on needs

.content-box-green[**Benefit**]
+ Increase in farming profit
+ Decrease in adverse impact on the environment

---
class: middle

# Estimation of Site-specific Economically Optimal Input Rates (EOIRs)

+ A producer's profit maximization problem: 
\begin{equation}
\operatorname*{max}_{I} \quad p \cdot f(I, \mathbf{c}) - w \cdot I - OC \qquad (1)
\end{equation}

<br>

+ $p$: per-unit crop price 
+ $w$: per-unit input price
+ $I$: input application rate
+ $\mathbf{c}$: a collection of field characteristics
+ $f(\cdot)$: yield response function, input-yield causal relationship
+ $OC$: other costs of production 


---
class: middle

# Estimation of Site-specific Economically Optimal Input Rates (EOIR)

.content-box-red[**In reality**]
+ It is difficult to obtain information for site-specific yield response functions
  * the impact of an input on yield is heterogeneous 
  * the relationship involves a complex biophysical process

+ This difficulty is the primary reason for the relatively low adoption rate of site-specific input management `r Citep(bib, "lowenberg2019setting")`


---
class: middle
<!-- part 1 -->
# Recent Efforts Towards More Accurate Yield Response and EOIR Estimation

.content-box-green[**On-farm Precision Experimentation (OFPE)**] `r Citep(bib, "bullock2019")`:
+ Whole-field experimentation
  * more spatially detailed experiment data 
    - have greater local variation in experimental input application rates and soil/field characteristics


---
class: middle
<!-- part 2 -->
# Recent Efforts Towards More Accurate Yield Response and EOIR Estimation

.content-box-green[**Application of Machine Learning (ML) methods**]:
+ Random Forest `r Citep(bib, "krause2020random")`
+ Convolutional Neural Network `r Citep(bib, c("barbosa2020risk", "barbosa2020modeling"))`
+ Shape-constrained Generalized Additive Model `r Citep(bib, "Gardner21")`

<br>

.content-box-red[**Past studies**]
+ Focus on predicting <span style="color:red">yield level</span> well
+ Compare different models based on <span style="color:red">yield prediction accuracy</span> 
  * Because the model's yield prediction accuracy is easily evaluated

---
class: middle

# Fundamental Information Necessary to Identify EOIR

The producer's profit maximization problem: 

\begin{equation}
\operatorname*{max}_{I} \quad p \cdot f(I, \mathbf{c}) - w \cdot I - OC \qquad (1)
\end{equation}

<br>

.content-box-red[**First order condition**]:

\begin{align}
p \cdot \frac{\partial f(I,\mathbf{c})}{\partial I} - w &= 0 \\
\newline
\Rightarrow \frac{\partial f(I^{*}(p,w,\mathbf{c}), \mathbf{c})}{\partial I} &\equiv \frac{w}{p} \qquad (2)
\end{align}

+ Knowledge of the <span style="color:red">"change"</span> in yield in response to a change in input rate is the necessary information to identify EOIR.

---

<!-- NOTE: Part 1 -->
# Prediction-oriented ML Methods and Causal Forest

.content-box-green[**Prediction-oriented ML methods**] (e.g., Random Forest, Convolutional Neural Network)

+ are designed to predict the <span style="color:red">level of the dependent variable (yield) </span> well
+ the impact of a treatment (input application rate) can be estimated by plugging in two different rates $(I_{k} \mbox{ and } I_{k+1})$ to the trained yield model and seeing the difference in their predicted yield values:

<br>

\begin{equation}
\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}(\mathbf{c_i}) = \hat{f}(I_{k+1}, \mathbf{c_i}) - \hat{f}(I_{k}, \mathbf{c_i}) \qquad (3)
\end{equation}

<br>

+ $\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}$: an estimated impact of the input rate changing from $I_{k}$ to $I_{k+1}$ on yield
+ $\hat{f}(\cdot)$: a trained predictive yield model
+ $\mathbf{c_i}$: a collection of field characteristics at site $i$


---

<!-- NOTE: Part 2 (predict level of the yields)--> 
# Prediction-oriented ML Methods and Causal Forest

.content-box-green[**Prediction-oriented ML methods**] (e.g., Random Forest, Convolutional Neural Network)

+ are designed to predict the <span style="color:red">level of the dependent variable (yield) </span> well
+ the impact of a treatment (input application rate) can be estimated by plugging in two different rates $(I_{k} \mbox{ and } I_{k+1})$ to the trained yield model and seeing the difference in their predicted yield values:

<br>

\begin{equation}
\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}(\mathbf{c_i}) = 
\color{red}{\underbrace{\hat{f}(I_{k+1}, \mathbf{c_i})}_\text{step 1}} 
-
\color{red}{\underbrace{\hat{f}(I_{k}, \mathbf{c_i})}_\text{step 1}} \qquad (3)
\end{equation}

<br>

+ $\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}$: an estimated impact of the input rate changing from $I_{k}$ to $I_{k+1}$ on yield
+ $\hat{f}(\cdot)$: a trained predictive yield model
+ $\mathbf{c_i}$: a collection of field characteristics at site $i$

---

<!-- NOTE: Part 3 (predict level of the yields)--> 
# Prediction-oriented ML Methods and Causal Forest

.content-box-green[**Prediction-oriented ML methods**] (e.g., Random Forest, Convolutional Neural Network)

+ are designed to predict the <span style="color:red">level of the dependent variable (yield) </span> well
+ the impact of a treatment (input application rate) can be estimated by plugging in two different rates $(I_{k} \mbox{ and } I_{k+1})$ to the trained yield model and <span style="color:blue">seeing the difference in their predicted yield values</span>:

<br>

\begin{equation}
\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}(\mathbf{c_i}) = \color{blue}{\overbrace{
\color{red}{\underbrace{\hat{f}(I_{k+1}, \mathbf{c_i})}_{\text{step 1}}}
\color{blue}{\mathbf{-}} 
\color{red}{\underbrace{\hat{f}(I_{k}, \mathbf{c_i})}_{\text{step 1}}}
}^\text{step 2}}
 \qquad (3)
\end{equation}

<br>

+ $\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}$: an estimated impact of the input rate changing from $I_{k}$ to $I_{k+1}$ on yield
+ $\hat{f}(\cdot)$: a trained predictive yield model
+ $\mathbf{c_i}$: a collection of field characteristics at site $i$

---

<!-- NOTE: Part 4 (predict level of the yields)--> 
# Prediction-oriented ML Methods and Causal Forest

.content-box-green[**Prediction-oriented ML methods**] (e.g., Random Forest, Convolutional Neural Network)

+ are designed to predict the <span style="color:red">level of the dependent variable (yield) </span> well
+ the impact of a treatment (input application rate) can be estimated by plugging in two different rates $(I_{k} \mbox{ and } I_{k+1})$ to the trained yield model and <span style="color:blue">seeing the difference in their predicted yield values</span>:

<br>

\begin{equation}
\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}(\mathbf{c_i}) = \color{blue}{\overbrace{
\color{red}{\underbrace{\hat{f}(I_{k+1}, \mathbf{c_i})}_{\text{step 1}}}
\color{blue}{\mathbf{-}} 
\color{red}{\underbrace{\hat{f}(I_{k}, \mathbf{c_i})}_{\text{step 1}}}
}^\text{step 2}}
 \qquad (3)
\end{equation}

<br>

+ $\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}$: an estimated impact of the input rate changing from $I_{k}$ to $I_{k+1}$ on yield
+ $\hat{f}(\cdot)$: a trained predictive yield model
+ $\mathbf{c_i}$: a collection of field characteristics at site $i$

<span style="color:red">The estimated change in yield $(\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}(\mathbf{c_i}))$ in Equation (3) does not mean the causal impact of the input rate on yield.</span>

---

<!-- NOTE: Part 5 (CF) --> 
# Prediction-oriented ML Methods and Causal Forest

.content-box-green[**Prediction-oriented ML methods**] (e.g., Random Forest, Convolutional Neural Network)

+ are designed to predict the <span style="color:red">level of the dependent variable (yield) </span> well
+ the impact of a treatment (input application rate) can be estimated by plugging in two different rates $(I_{k} \mbox{ and } I_{k+1})$ to the trained yield model and <span style="color:blue">seeing the difference in their predicted yield values</span>:

\begin{equation}
\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}(\mathbf{c_i}) = 
\hat{f}(I_{k+1}, \mathbf{c_i}) - \hat{f}(I_{k}, \mathbf{c_i}) \qquad (3)
\end{equation}

<br>

.content-box-green[**Causal Forest**] `r Citep(bib, c("athey2016recursive", "Wager2018a"))`

+ is designed to estimate <span style="color:red"> the heterogeneous impact of a treatment (input application rate) </span> directly without predicting yield levels

\begin{equation}
\Delta \hat{Y}_{I_{k} \rightarrow I_{k+1}}(\mathbf{c_i}) = \hat{\tau}_{I_{k} \rightarrow I_{k+1}}(\mathbf{c_i}) \qquad (4)
\end{equation}

<br>

+ $\hat{\tau}_{I_{k} \rightarrow I_{k+1}}(\cdot)$: an estimated CF model to predict treatment effects of changes in input rates from $I_k$ to $I_{k+1}$

---

# Causal Forest: Illustration (Corn, Seed Rate Experiment)

.left4[
+ A causal forest is an ensemble of *causal trees*
+ Treatment effect is calculated at each node

<br>

.content-box-green[**Experiment**]
+ **Control**: $27,000$ seeds/ha
+ **Treated**: $31,000$ seeds/ha

.content-box-green[**Dependent variable**]
+ Yield (kg/ha) 

.content-box-green[**Independent variables**]
+ Electrical conductivity (`ecs`)(dS/m)
+ Slope (`slope`) (degree)
]

.right6[

```{r ct-ex, fig.cap = "Figure 1: An illustrative example of a causal tree"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/ctree.png"))
# par(family = "Times")
# fancyRpartPlot(opfit, sub = "")
```

]

---
class:middle

# Research Questions

+ Does Causal Forest (CF) outperform traditional ML approaches in estimating site-specific EOIR and result in higher economic profits?

<br>

+ Can we trust yield prediction accuracy as the criteria to select a model to find the model that produces the highest economic profit?


---

class: inverse, center, middle
name: method

# Materials and Methods

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

---
class:middle
<!-- part 1 -->
# Methods

+ Monte Carlo simulations of nitrogen fertilizer application experiments for corn production
  * hypothetical field, on which OFPEs are run
  * use a specific functional form for site-specific yield response functions
  * site-specific economically optimal nitrogen rates (EONRs) are known for a given combination of field characteristics, crop, and input prices 

---
class:middle

# Monte Carlo Simulations

.content-box-green[**The flow of the simulation**]
1. Data Generation
  * generate one thousand rounds of synthetic field data that "resembles" an actual field
  * generate OFPE data for each field 
2. Evaluation of model's performance 
  * train ML models with the training data
  * predict site-specific EONRs (and yields) with the testing data
  * evaluate the accuracy of EONR predictions (and yield predictions) 

---
class: middle 

# Field Configurations

.left4[
.content-box-green[**Size of units**]
+ "plot": 18.3 m × 73.2 m 
+ "subplot": 18.3 m × 18.3 m
+ "cell": 3.05 m × 3.05 m

<br>

+ "subplot" is the unit of analysis
+ There are 1536 subplots in the field
]


.right6[

```{r field-map, fig.cap = " Figure 2: Partitioning of field into plots, subplots and cells"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/Field.png"))
```
]

---
<!-- part 1 -->
# Yield Response Functions and True EONR

.content-box-green[**Yield response functions**]

Yield response function is assumed to follow Mitscherlich-Baule functional form:

\begin{equation}
f(N: \alpha, \beta, ymax) = ymax(1-exp(\alpha + \beta \cdot N)) + \varepsilon \qquad (5)
\end{equation}


<br>

+ $N$: the nitrogen fertilizer application rate (kg/ha) 
+ $ymax, \alpha, \beta$: local production conditions
+ $\varepsilon$: yield error term (kg/ha) 


---
<!-- part 2 -->
# Yield Response Functions and True EONR

.content-box-green[**Yield response functions**]

Yield response function is assumed to follow Mitscherlich-Baule functional form:

\begin{equation}
f(N: \alpha, \beta, ymax) = ymax(1-exp(\alpha + \beta \cdot N)) + \varepsilon \qquad (5)
\end{equation}


<br>

+ $N$: the nitrogen fertilizer application rate (kg/ha) 
+ $ymax, \alpha, \beta$: local production conditions
+ $\varepsilon$: yield error term (kg/ha) 

<br>

.content-box-green[**True EONR**]

$$
N_{opt} = \underset{\mathrm{N}}{argMax}(p \cdot f(N: \alpha, \beta, ymax) - w \cdot N) \qquad (6)
$$

+ $p$: price of corn `r paste0("$", 0.138, "/kg")`
+ $w$: price of N fertilizer `r paste0("$", 1.323, "/kg")`

---
class: middle 

# Data Generation: Field Characteristics and Error

.left4[
<br>
<br>
+ $ymax$, $\alpha$, and $\beta$ and error term $(\varepsilon)$ were modeled as spatially autocorrelated. 
]

.right6[

```{r fig-parameters, out.width="100%", cache=T, fig.cap = "Figure 4: An illustrative example of spatial distributions of field characteristics"}
grid.arrange(
  field_ymax+ theme_void()+ theme(legend.title = element_blank()),
  field_alpha+ theme_void()+theme(legend.title = element_blank()),
  field_beta+ theme_void()+theme(legend.title = element_blank()),
  field_m_error+ theme_void()+theme(legend.title = element_blank()),
  ncol = 2, nrow = 2)
```
]

---
class: middle 

# Data Generation: Nitrogen Rate (Trial Design)

.left4[

<br>
<br>

+ Every simulation round, <span style="color:blue">five experimental nitrogen rates</span> were determined based on the range of true EONRs

<br>

+ Each plot is assigned a single experimental N rate according to the fixed trial design
]

.right6[
```{r fig-nExp, out.width="100%", cache=T, fig.cap="Figure 5: An example of experimental design of N"}
field_Ndesign + 
  theme_void() +
  ggtitle(NULL)
```
] 

---
class: middle 

# Data Generation: Yield and EONR

```{r}
cell_yield <- 
  vis_yield_cell + 
  ggtitle("(1) Yield (kg/ha)") +
  theme_void() + 
  theme(legend.title = element_blank())

cell_optN <-
  field_optN +
  ggtitle("(2) EONR (kg/ha)") +
  theme_void() +
  theme(legend.title = element_blank())
```

```{r, out.width="70%", fig.cap = "Figure 6: An illustrative example of spatial distributions of generated yield and EONR"}
cell_yield | cell_optN
```


---
class: middle

# Modeling Scenarios

+ Researchers observe all the variables (characteristics) related to site-specific yield response functions, but do not know the functional form.

$$
f(N, \mathbf{c}) = ymax(1-exp(\alpha + \beta N)) + \varepsilon \qquad (5)
$$

<br>

.content-box-green[**Four modeling scenarios**]
1. **"aby"**: $\alpha$, $\beta$, ymax 
2. **"abytt"**: $\alpha$, $\beta$, ymax, $\theta_1$, $\theta_2$ $(\theta$s are irrelevant variables)
3. **"aabbyy"**: 
  - $\alpha_1$, $\alpha_2$ $(\alpha = \alpha_1 + \alpha_2)$ 
  - $\beta_1$, $\beta_2$ $(\beta = \beta_1 + \beta_2)$ 
  - $ymax_1$, $ymax_2$ $(ymax = ymax_1 + ymax_2)$
4. **"aabbyytt"**: $\alpha_1$, $\alpha_2$, $\beta_1$, $\beta_2$, $ymax_1$, $ymax_2$, $\theta_1$, $\theta_2$

---
class: middle

# Training Models and Estimating Site-specific EONRs

## Estimation methods
+ Random Forest (RF)
+ Boosted Random Forest (BRF)
+ Convolutional Neural Network (CNN)
  * follows the architecture "Late Fusion" of `r Citet(bib, "barbosa2020modeling")`
+ Causal Forest (CF)
  * *CF-base* approach

<br>

## Training and testing datasets
+ In every simulation round a dataset from a different simulation round was used as the testing dataset for evaluation of yield (only for RF, BRF, adn CNN) and EONR predictions. 

---

<!-- part 1 -->
# CF Modeling

CF estimates the impact of N rates changing from the control N rate $(N^{con})$ to the treatment N rate $(N^{tre})$.
+ We have five experimental N rates:  
  * $N_1, N_2, N_3, N_4, N_5$ $(N_1 < N_2 < ... < N_5)$

---
<!-- part 2 -->
# CF Modeling

CF estimates the impact of N rates changing from the control N rate $(N^{con})$ to the treatment N rate $(N^{tre})$.
+ We have five experimental N rates:  
  * $N_1, N_2, N_3, N_4, N_5$ $(N_1 < N_2 < ... < N_5)$

.content-box-green[**Pairwise grouped N rates**]

+ $(N^{con}, N^{tre}) = {(N_1, N_2),(N_1, N_3),(N_1, N_4), (N_1, N_5)}$

---
<!-- part 3 -->
# CF Modeling

CF estimates the impact of N rates changing from the control N rate $(N^{con})$ to the treatment N rate $(N^{tre})$.
+ We have five experimental N rates:  
  * $N_1, N_2, N_3, N_4, N_5$ $(N_1 < N_2 < ... < N_5)$

.content-box-green[**Pairwise grouped N rates**]

+ $(N^{con}, N^{tre}) = {(N_1, N_2),(N_1, N_3),(N_1, N_4), (N_1, N_5)}$

<br>

.content-box-green[**CF-base approach**] 

CF-base approach always estimates the treatment effects using the lowest N rate $N_1$:

\begin{equation}
\Delta Y_{N_1 \rightarrow N_m}(\mathbf{\Omega_{i}}) = \hat{\tau}_{N_{1} \rightarrow N_{m}}(\mathbf{\Omega_{i}}) \quad m\in\{2,3,4,5\}  \qquad (6)
\end{equation}

+ $\mathbf{\Omega_{i}}$: a list of subplot-level explanatory variables 

<br>

Site-specific EONRs were identified by finding the N rate resulting in the highest profit for each site $i$.

---
class: middle

# Evaluation of Yield and EONR Predictions

.content-box-green[**The accuracy of EONR estimation**] 

+ RMSE (kg/ha) of the EONR estimation against the true EONR:
\begin{equation}
\mbox{RMSE of EONR estimation} = \sqrt{\frac{1}{1536}\sum_{i=1}^{1536}(N^{opt}_{i} - \hat{N}^{opt}_{i})^2} 
\end{equation}

+ Estimated per-ha profit-deficits relative to the true maximum profit:

\begin{equation}
\hat{\pi}_{def} = \pi - \hat{\pi}
\end{equation}

<br>

.content-box-green[**The accuracy of yield estimation**]

+ RMSE (kg/ha) of the yield prediction against the true yields:

\begin{equation}
\mbox{RMSE of yield prediction} = \sqrt{\frac{1}{1536}\sum_{i=1}^{1536}(y_{i} - \hat{y}_{i})^2}
\end{equation}


---
class: inverse, center, middle
name: results

# Results

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

---
class: middle
<!-- part 1 -->
# Comparison of EONR Estimation Accuracy

```{r, out.width="80%"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/tab_EONR_CF.png"))
```

---

# The Underlying Cause of CF-base’s Superior EONR Predictions

```{r, out.width="70%", fig.cap = "Figure 7: True treatment effects vs estimated treatment effects (scenario: aabbyytt)"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/fig_te.png"))
```

---
class: middle
<!-- part 1 -->
# Yield Prediction Performance

```{r, out.width="80%"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/tab_y.png"))
```

---
class: middle
<!-- part 2 -->
# Yield Prediction Performance

```{r, out.width="80%"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/tab_y_RF_CNN.png"))
```

---
class: middle
<!-- part 3 -->
# Yield Prediction Performance

```{r, out.width="80%"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/tab_y_RF_BRF.png"))
```

---
class: middle

# Does the model with the highest yield predictive performance lead to the highest EONR estimation performance?

```{r, out.width="80%"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/tab_y_pi.png"))
```

---
class: middle
<!-- Part2: example RF in aby scenario (highlight RF)-->
# Does the model with the highest yield predictive performance lead to the highest EONR estimation performance?

```{r, out.width="80%"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/tab_y_pi_RF.png"))
```

---
class: middle
<!-- Part3: explanation -->
# Does the model with the highest yield predictive performance lead to the highest EONR estimation performance?

```{r, out.width="80%"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/tab_y_pi.png"))
```

---
class: middle
<!-- Part4: Total #YP (highlight total #YP) -->
# Does the model with the highest yield predictive performance lead to the highest EONR estimation performance?

```{r, out.width="80%"}
include_graphics(here("GitControlled/Presentation/Defense/Photo/tab_y_pi_RF_CNN.png"))
```

---

class: inverse, center, middle
name: results

# Conclusion

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

---
<!-- part 1 -->

## 1. Site-specific EONR estimation performance
+ CF-base outperformed RF, BRF and CNN in estimating site-specific EONR
  * CF can estimate the impact of N rates on yields more accurately than other yield-prediction oriented ML methods. 


---
<!-- part 2 -->
## 1. Site-specific EONR estimation performance
+ CF-base outperformed RF, BRF and CNN in estimating site-specific EONR
  * CF can estimate the impact of N rates on yields more accurately than other yield-prediction oriented ML methods. 

<br>

## 2. Can we trust yield prediction accuracy as the criteria to select a model to estimate EONR?
+ Yield prediction accuracy should not be used as a model selection criterion if the goal of the experiment is to estimate EONR
  * The best model in predicting yields is not necessarily the best model in predicting EONRs and profit generation

---
class: middle
<!-- part 1 -->
## Limitations and Future Studies
1.

<br>
2.

<br>
3.


---
class: middle
<!-- part 2 -->
## Limitations and Future Studies
1. Drawback of CF-base: CF-base predicts a limited set of discrete experimental N rates
  * increase the number of experimental N rates?
  * use post-estimation spatial smoothing of the estimated EONR?

<br>
2.

<br>
3.

---
class: middle
<!-- part 3 -->
## Limitations and Future Studies

1. Drawback of CF-base: CF-base predicts a limited set of discrete experimental N rates
  * increase the number of experimental N rates?
  * use post-estimation spatial smoothing of the estimated EONR?
<br>
<br>
2. In what conditions CF-base outperforms other ML methods? 
  * Can the size of the field used in the OFPE affect the performance of CF?

<br>
3.

---
class: middle
<!-- part 4 -->
## Limitations and Future Studies

1. Drawback of CF-base: CF-base predicts a limited set of discrete experimental N rates
  * increase the number of experimental N rates?
  * use post-estimation spatial smoothing of the estimated EONR?
<br>
<br>
2. In what conditions CF-base outperforms other ML methods? 
  * Can the size of the field used in the OFPE affect the relative performance of CF-base?
<br>
<br>
3. What the performance of CF-base and other ML methods would be in a dynamic setting?
  * use of Crop simulation models (e.g., APSIM, DSSAT) to reflect more realistic data generating process

---
class:middle

# Thank you for listening
