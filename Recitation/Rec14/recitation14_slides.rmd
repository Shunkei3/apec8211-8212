---
title: "APEC8212: Recitation 14"
author: 
  - "Shunkei Kakimoto" 
header-includes:
   - \usepackage{mathtools}
   - \usepackage{color}
   - \usepackage{amsmath}
output:
  xaringan::moon_reader:
    self_contained: true
    css: ../xaringan-themer.css 
    lib_dir: libs
    nature: 
      highlightStyle: github
      highlightLines: true
---
class: middle

```{r, child = '../setup.rmd', cache = FALSE}
```

```{r xaringan-scribble, echo=FALSE}
xaringanExtra::use_scribble()
```


```{r setup, include=FALSE, cache = FALSE}
options(htmltools.dir.version = FALSE)

# /*===== Reference =====*/
suppressMessages(library(RefManageR))

BibOptions(
  check.entries = FALSE,
  bib.style = "authoryear",
  style = "markdown",
  hyperlink = FALSE,
  dashed = TRUE,
  max.names = 2,
  longnamesfirst = FALSE
)
bib <- ReadBib("cite.bib")
```

```{r, include = F, cache = FALSE}
library(data.table)
library(ggplot2)
library(dplyr)
library(gganimate)
library(gifski)
library(gganimate)
# library(learnr)
```

```{r, include = F, eval=F, cache = FALSE}
httpgd::hgd()
httpgd::hgd_browse()
```

```{r xaringan-tachyons, echo=FALSE}
xaringanExtra::use_tachyons()
```

.content-box-green[**A Useful tip:**]

hitting letter "o" key will give you a panel view of the slides

---
class: middle

# Outline
1.[Review DID](#DID)

2.[Panel estimation with R](#R)

---
class: inverse, center, middle
name: DID

# basic DID

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

???
+ Okay, so in the class, we leaned DID framework using potential outcome framework. 

---
class: middle

## Example: The effect of minimum wage on employment

```{r, echo=F, out.width = "80%"}
knitr::include_graphics("photos/did0_0.png")
```

???
+ Here is an example. 
+ Like Card and Krueger (1994), suppose that we want to estimate the causal impact of minimum wage on employment. some intervention of minimum wage on employment happens in a treated state. 
+ The black solid like indicate the observed trend of employment trend in treatment state and control state, and the dashed line is the counterfactual employment trend in treatment state. 

---
class: middle

```{r, echo=F, out.width = "80%"}
knitr::include_graphics("photos/did1_1.png")
```

???
+ Now, we can see four types of differences in this graph. 
+ (1) ATT or differnce in changes over time
+ (2) time trend in treatment group if it had not been treated
+ (3) time trend in control group

---
class: middle

```{r, echo=F, out.width = "70%"}
knitr::include_graphics("photos/did1_1.png")
```

.content-box-green[**Question**]

1. Which differences are observed? Which differences are not observed?
2. Which differences is the DID estimand?
3. In what condition and how the estimand of DID is identified? 

???
+ Here are the questions for you guys. 
+ Which differences are observed and which differences are not observed?Ã¥

---
class: middle

## Parallel trend assumption

```{r, echo=F, out.width = "60%"}
knitr::include_graphics("photos/did1_2.png")
```

<p style="text-align: center;"> <span style="color:red"><b>(2)</b></span> = <span style="color:red"><b>(3)</b></span> </p>
So, 

$$ATT = (1) = (4) - \color{red}{(2)} = (4) - \color{red}{(3)}$$

???
+ Change in outcomes for the treatment group before and after if the treatment group had not been treated. 

---
class: middle

## Parallel trend assumption

```{r, echo=F, out.width = "50%"}
knitr::include_graphics("photos/did1_2.png")
```

$$\begin{align*}
ATT 
  &= (2) \\
  &= E[Y_{i,2}(1)Y_{i,2}(0)|D_i=1] \\
  &= (4) - (3) \\
  &= E[Y_{i,2}(1) - Y_{i,1}(1)|D_i=1] - E[Y_{i,2}(0)Y_{i,1}(0)|D_i=0]
\end{align*}$$

???
+ Change in outcomes for the treatment group before and after if the treatment group had not been treated. 

---
class: middle 

```{r, echo=F, out.width = "50%"}
knitr::include_graphics("photos/did1_2.png")
```

.bg-washed-green.b--dark-green.ba.bw2.br3.shadow-2.ph2.mt2[
<span style="color:blue">**Parallel trend assumption**</span>

$$E[Y_{i,2}(0)-Y_{i,1}(0)|D_i=1]=E[Y_{i,2}(0)-Y_{i,1}(0)|D_i=0]$$

Verbally: In the absence of treatment, the difference between the treatment and control group is constant over time.
]


---
class: middle 

## Violation of the parallel trend assumption
For example, 

```{r, echo=F, out.width = "60%"}
knitr::include_graphics("photos/did3_vio1.png")
```

.content-box-green[**Question**]
Is ATT estimate from DID approach biased upward or downward?

???
+ Okay, let's think about what if the parallel trend assumption is violated. 

---
class: middle

.content-box-green[**Question**]

What if the assumption of no anticipation effect is violated? What does the figure look like?

???
+ First of all, what does the assumption of no anticipation? 
+ Mathematically? $Y_{i,1}(0)=Y_{i,1}(1)$
  * That is, the potential outcomes in period 1 don't depend on treatment status in period 2. 

---

class: middle

## Violation of the no anticipation effect

For example, 

```{r, echo=F, out.width = "80%"}
knitr::include_graphics("photos/did3_vio2.png")
```

???
+ So, the problem here is that depending on the treatment status in period two, the outcome changes. 
+ For example, knowing that the minimum wage decreases, employers might build new factories before the new policy starts but they would not if the minimum wage decreases. 

---
class: middle

+ D needs to be exogenous event 
<!--   * Specifically, conditional on $X_{it}$ for $\forall t$, $D_{it}$ and the idiosyncratic errors $\varepsilon_{it}$ are statistically independent
    - CIA implies no anticipation effect -->

.content-box-green[**Example**]

Card and Krueger (1994): 

+ Question: Does increase in minimum wage decrease the labor demand?

+ Exogenous event:  New Jersy's 1992 increase of the minimum hourly wage 

???
+ To credibly estimate the policy effect, the 

+ Policy change is generally regarded as an exogenous shock. In the case of Card and Krueger (1994), the policy of minimum wage actually started after the it was  adopted, maybe people and 
---
class: middle 

Eissa and Liebman (1996):
+ Question: Does tax credit affect labor supply and work hours?
+ Exogenous event: Major expansions of EITC of Tax Reform Act in 1986

DiTella and Schargrodsky (2004): 

+ Question: Does the street presence of police officer reduces car theft?
+ Exogenous event: ?

???
+ DiTella and Schargrodsky (2004)'s study is interesting. They use DID approach to answer the question whether the street presence of police officers car theft. 
+ What do you think? Do you have any idea about whether the presence of police officers is exogenous?

---

class: middle 


.content-box-green[**Example**]

Eissa and Liebman (1996):
+ Question: Does tax credit affect labor supply and work hours?
+ Exogenous event: Major expansions of EITC of Tax Reform Act in 1986

DiTella and Schargrodsky (2004): 

+ Question: Does the street presence of police officer reduces car theft?
+ Exogenous event: An expansion of police deployment around the city due to a terrorist attack 

???
+ DiTella and Schargrodsky (2004)'s study is interesting. They use DID approach to answer the question whether the street presence of police officers car theft. 
+ Do you have any idea about whether the 
